version: '3.8'

services:
  # Main Trading Application
    smart-entry:
        build:
              context: .
                    dockerfile: Dockerfile
                        container_name: cfd-smart-entry
                            environment:
                                  - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
                                        - GOOGLE_API_KEY=${GOOGLE_API_KEY}
                                              - GITHUB_TOKEN=${GITHUB_TOKEN}
                                                    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
                                                        volumes:
                                                              - ./trade_logs:/app/trade_logs
                                                                    - ./config:/app/config
                                                                        ports:
                                                                              - "8080:8080"
                                                                                  networks:
                                                                                        - trading-network
                                                                                            restart: unless-stopped
                                                                                                depends_on:
                                                                                                      - prometheus
                                                                                                      
                                                                                                        # Prometheus - Metrics Collection
                                                                                                          prometheus:
                                                                                                              image: prom/prometheus:latest
                                                                                                                  container_name: prometheus
                                                                                                                      volumes:
                                                                                                                            - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
                                                                                                                                  - prometheus_data:/prometheus
                                                                                                                                      command:
                                                                                                                                            - '--config.file=/etc/prometheus/prometheus.yml'
                                                                                                                                                  - '--storage.tsdb.path=/prometheus'
                                                                                                                                                        - '--web.enable-lifecycle'
                                                                                                                                                            ports:
                                                                                                                                                                  - "9090:9090"
                                                                                                                                                                      networks:
                                                                                                                                                                            - trading-network
                                                                                                                                                                                restart: unless-stopped
                                                                                                                                                                                
                                                                                                                                                                                  # Grafana - Dashboard & Visualization
                                                                                                                                                                                    grafana:
                                                                                                                                                                                        image: grafana/grafana:latest
                                                                                                                                                                                            container_name: grafana
                                                                                                                                                                                                environment:
                                                                                                                                                                                                      - GF_SECURITY_ADMIN_USER=admin
                                                                                                                                                                                                            - GF_SECURITY_ADMIN_PASSWORD=admin
                                                                                                                                                                                                                  - GF_USERS_ALLOW_SIGN_UP=false
                                                                                                                                                                                                                      volumes:
                                                                                                                                                                                                                            - grafana_data:/var/lib/grafana
                                                                                                                                                                                                                                  - ./monitoring/grafana/provisioning:/etc/grafana/provisioning
                                                                                                                                                                                                                                        - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards
                                                                                                                                                                                                                                            ports:
                                                                                                                                                                                                                                                  - "3000:3000"
                                                                                                                                                                                                                                                      networks:
                                                                                                                                                                                                                                                            - trading-network
                                                                                                                                                                                                                                                                restart: unless-stopped
                                                                                                                                                                                                                                                                    depends_on:
                                                                                                                                                                                                                                                                          - prometheus
                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                            # Node Exporter - System Metrics
                                                                                                                                                                                                                                                                              node-exporter:
                                                                                                                                                                                                                                                                                  image: prom/node-exporter:latest
                                                                                                                                                                                                                                                                                      container_name: node-exporter
                                                                                                                                                                                                                                                                                          volumes:
                                                                                                                                                                                                                                                                                                - /proc:/host/proc:ro
                                                                                                                                                                                                                                                                                                      - /sys:/host/sys:ro
                                                                                                                                                                                                                                                                                                            - /:/rootfs:ro
                                                                                                                                                                                                                                                                                                                command:
                                                                                                                                                                                                                                                                                                                      - '--path.procfs=/host/proc'
                                                                                                                                                                                                                                                                                                                            - '--path.sysfs=/host/sys'
                                                                                                                                                                                                                                                                                                                                  - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
                                                                                                                                                                                                                                                                                                                                      ports:
                                                                                                                                                                                                                                                                                                                                            - "9100:9100"
                                                                                                                                                                                                                                                                                                                                                networks:
                                                                                                                                                                                                                                                                                                                                                      - trading-network
                                                                                                                                                                                                                                                                                                                                                          restart: unless-stopped
                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                          networks:
                                                                                                                                                                                                                                                                                                                                                            trading-network:
                                                                                                                                                                                                                                                                                                                                                                driver: bridge
                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                volumes:
                                                                                                                                                                                                                                                                                                                                                                  prometheus_data:
                                                                                                                                                                                                                                                                                                                                                                    grafana_data:
